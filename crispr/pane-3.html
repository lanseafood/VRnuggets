<!doctype html>
<html>
  <head>
    <style>
      body {
        margin: 0;
        overflow: hidden;
      }
    </style>

    <script src="three.js"></script>
  </head>
  <body>
    <div id="world"></div>

    <script>
      // globals ---
      var scene;
      var renderer;
      var camera;
      var scale = 1;

      // helpers ---
      function handleResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      }

      var CustomSinCurve = THREE.Curve.create(
        // custom curve constructor
        function (scale) { 
          this.scale = (scale === undefined) ? 1 : scale;
        },

        // getPoint: t is between 0-1
        function (t) {
          var tx = t * 5 - 1.5;
          var ty = Math.sin( 1.5 * Math.PI * t );
          var tz = 0;
          return new THREE.Vector3( tx, ty, tz ).multiplyScalar( this.scale );
        }
      );

      // main ---
      function init() {
        // create a scene to hold all elements, eg objects, cameras, lights
        scene = new THREE.Scene();

        // create a render, sets the background color and the size
        renderer = new THREE.WebGLRenderer();
        renderer.setClearColor(0x090221, 1.0);
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMapEnabled = true;

        // create a camera, which defines where we're looking at.
        // position and point it to the center of the scene
        camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.x = 45;
        camera.position.y = 46;
        camera.position.z = 43;
        camera.lookAt(scene.position);

        // ----------
        // add the scene

        var ribosomeGeometry = new THREE.SphereGeometry(5, 30, 30);
        var ribosomeMaterial = new THREE.MeshNormalMaterial();
        var ribosome = new THREE.Mesh(ribosomeGeometry, ribosomeMaterial);
        ribosome.name = 'ribosome';
        ribosome.position.x = 30;
        ribosome.position.y = 8;
        scene.add(ribosome);


        var dnaGeometry = new THREE.BoxGeometry(60, 1, 1);
        var dnaMaterial = new THREE.MeshNormalMaterial();
        var dna = new THREE.Mesh(dnaGeometry, dnaMaterial);
        dna.name = 'dna';
        dna.position.y = 10;
        scene.add(dna);

        var path = new CustomSinCurve(1);
        var rnaGeometry = new THREE.TubeGeometry(path, 64, 0.5, 8, false);
        var rnaMaterial = new THREE.MeshNormalMaterial( { color: 0x3D98D4 } );
        var rna = new THREE.Mesh(rnaGeometry, rnaMaterial);
        rna.name = 'rna'
        rna.position.x = 30;
        rna.position.y = 7;
        scene.add(rna);

        // ----------

        // add the output of the renderer to the html element
        document.body.appendChild(renderer.domElement);
        

        // call the render function, after the first render, interval is determined by requestAnimationFrame
        render();
      }

      function render() {
        // requestAnimationFrame tells the browser to deterine when its best to call render, which visualizes the scene
        requestAnimationFrame(render);
        
        // visualize the scene using the camera
        renderer.render(scene, camera);

        var ribosome = scene.getObjectByName('ribosome')
        var rna = scene.getObjectByName('rna')
        if(ribosome.position.x > -25) {
          ribosome.position.x -= 0.2;

          rna.position.x -= 0.2;
          scale += 0.02
          rna.scale.set(scale, 1, 1);
        }
      }

      window.onload = init;
      window.addEventListener('resize', handleResize, false);
    </script>
  </body>
</html>